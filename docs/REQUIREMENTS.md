# Marketing Hub - 統合マーケティングオートメーション システム要件定義書

**Version**: 2.0.0
**Last Updated**: 2026-02-01
**Status**: 本番稼働準備完了

---

## 1. システム概要

### 1.1 システム名
**Marketing Hub** - AI駆動型統合マーケティングオートメーションプラットフォーム

### 1.2 システムコンセプト
日本市場で主流のLINEマーケティングツール（Lステップ、Lプロ）およびファネルビルダー（UTAGE）の機能を統合し、さらにAIによる自動最適化を加えた次世代マーケティングプラットフォーム。

### 1.3 対象ユーザー
- オンラインコース販売者
- コーチ・コンサルタント
- 情報商材販売者
- ECサイト運営者
- マーケティングエージェンシー

### 1.4 競合製品との比較

| 機能 | Lステップ | UTAGE | Lプロ | **Marketing Hub** |
|------|----------|-------|-------|-------------------|
| LINEステップ配信 | ◎ | ○ | ◎ | ◎ |
| メールマーケティング | △ | ◎ | △ | ◎ |
| ファネルビルダー | × | ◎ | △ | ◎ |
| アフィリエイト | △ | ◎ | △ | ◎ |
| 会員サイト | × | ◎ | △ | ◎ |
| AI自動最適化 | × | × | × | ◎ |
| マルチテナント | × | × | × | ◎ |
| 2ティアアフィリエイト | × | ◎ | × | ◎ |

---

## 2. 機能要件

### 2.1 コンタクト管理（CRM）

#### 2.1.1 コンタクト情報
- **必須項目**: ID、テナントID、作成日時
- **基本情報**: 氏名、メールアドレス、電話番号、LINE User ID
- **属性情報**: 100+のカスタムフィールド対応
- **オプトイン状態**: メール/LINE/SMSの個別管理
- **ソース追跡**: 流入経路、アフィリエイト紹介者

#### 2.1.2 タグシステム
- 無制限のタグ作成
- タグの色分け・カテゴリ分け
- 自動タグ付け（トリガー連動）
- タグ条件による絞り込み

#### 2.1.3 スコアリング
- **リードスコア**: 0-100の購買意欲スコア
- **エンゲージメントスコア**: 0-100の活動度スコア
- **チャーンリスクスコア**: 0-100の離脱リスク
- **RFMスコア**: Recency/Frequency/Monetary分析

#### 2.1.4 セグメンテーション
- 動的セグメント（条件変更で自動更新）
- 11種類のプリセットセグメント
- AND/OR論理演算子
- ネスト条件対応

### 2.2 LINE連携（Lステップ相当）

#### 2.2.1 基本機能
- LINE公式アカウント連携
- 友だち追加/ブロック検知
- テキスト/Flexメッセージ送信
- マルチキャスト（500件まで）
- ブロードキャスト配信

#### 2.2.2 リッチメニュー
- 動的リッチメニュー切り替え
- 条件別メニュー表示
- タップアクション設定

#### 2.2.3 ステップ配信
- 無制限のステップ数
- 遅延設定（分/時間/日）
- 条件分岐
- A/Bテスト

#### 2.2.4 Webhook処理
- フォローイベント
- アンフォローイベント
- メッセージ受信
- ポストバックアクション

### 2.3 メールマーケティング

#### 2.3.1 配信機能
- SendGrid統合
- テンプレートシステム
- パーソナライズ変数
- 送信時刻最適化

#### 2.3.2 トラッキング
- 開封率追跡
- クリック率追跡
- バウンス検知
- 配信率モニタリング

#### 2.3.3 キャンペーンタイプ
- ステップメール（ドリップ）
- 一斉配信（ブロードキャスト）
- トリガー配信
- スケジュール配信

### 2.4 ファネルビルダー（UTAGE相当）

#### 2.4.1 ページビルダー
- JSONブロック構造
- ドラッグ＆ドロップUI
- レスポンシブデザイン
- カスタムCSS対応

#### 2.4.2 A/Bテスト
- 複数バリアント
- 重み付け配分
- 自動勝者判定
- 統計的有意性計算

#### 2.4.3 ページアクション
- タグ追加/削除
- キャンペーン開始
- URLリダイレクト
- ポップアップ表示
- Webhook送信
- Googleスプレッドシート連携

### 2.5 アフィリエイトシステム

#### 2.5.1 パートナー管理
- 4段階ランク（STANDARD/SILVER/GOLD/PLATINUM/VIP）
- 個別報酬率設定
- 承認フロー（自動/手動）
- 銀行振込/PayPal対応

#### 2.5.2 報酬体系
| 報酬タイプ | 説明 | デフォルト |
|-----------|------|-----------|
| オプトイン報酬 | LINE/メール登録 | 500円（固定） |
| フロントエンド報酬 | 低価格商品購入 | 30%（率） |
| バックエンド報酬 | 高価格商品購入 | 20%（率） |
| 2ティア報酬 | 紹介者の紹介 | 10%（率） |

#### 2.5.3 トラッキング
- クリック追跡（Cookie 30日）
- デバイスフィンガープリント
- 不正検知スコア（0-100）
- IPアドレス/User Agent記録

#### 2.5.4 コンバージョン
- LINE友だち追加
- メール登録
- フロントエンド商品購入
- バックエンド商品購入

#### 2.5.5 支払い管理
- 30日クーリングオフ期間
- 最低支払い金額（5,000円）
- 一括支払い処理
- 取引ID追跡

### 2.6 商品・決済システム

#### 2.6.1 商品タイプ
| タイプ | 説明 |
|--------|------|
| ONE_TIME | 単発購入 |
| SUBSCRIPTION | 月額/年額サブスクリプション |
| PAYMENT_PLAN | 分割払い |

#### 2.6.2 商品カテゴリ
| カテゴリ | 説明 | 用途 |
|---------|------|------|
| FRONTEND | フロントエンド商品 | 低価格オファー、無料オファー |
| BACKEND | バックエンド商品 | 高価格商品、メインサービス |

#### 2.6.3 Stripe連携
- Checkout Session作成
- Payment Intent処理
- サブスクリプション管理
- Webhookイベント処理

### 2.7 会員サイト・コース

#### 2.7.1 コース管理
- 無制限コース作成
- レッスン構造化
- プログレッシブリリース（登録後○日で公開）

#### 2.7.2 レッスン形式
- テキストコンテンツ
- 動画（アップロード/YouTube/Vimeo）
- 視聴時間トラッキング

#### 2.7.3 アクセス制御
- 商品購入連動
- 有効期限設定
- 進捗状況追跡

### 2.8 AIオートメーション

#### 2.8.1 感情分析エンジン
- リアルタイム感情分類（positive/neutral/negative）
- 13種類の感情検出
- チャーン早期警告
- エスカレーション推奨

#### 2.8.2 購買意図分析
- 意図スコア（0-100）
- 5段階意図分類
- 10種類の心理的障壁検出
- 推奨アプローチ生成

#### 2.8.3 予測エンジン
- コンバージョン確率予測
- チャーンリスク計算
- LTV（生涯価値）推定
- 次回購入予測
- 最適送信時刻予測
- 最適チャネル推奨

#### 2.8.4 コンテンツ生成
- AIメール件名生成
- メール本文パーソナライズ
- LINEメッセージ生成
- SMS文面作成

#### 2.8.5 オートパイロット
- 3モード（提案/半自動/全自動）
- 安全ガード機能
- 予算制限
- 決定ログ記録

#### 2.8.6 A/B最適化
- 4アルゴリズム対応
- マルチアームドバンディット
- 動的トラフィック配分
- 自動勝者判定

### 2.9 トリガー・オートメーション

#### 2.9.1 トリガータイプ（15種類）
1. LINE友だち追加
2. メール登録
3. ページ閲覧
4. 商品閲覧
5. カート放棄
6. カートチェックアウト
7. 購入完了
8. メッセージ開封
9. リンククリック
10. フォーム送信
11. タグ追加/削除
12. スコア変更
13. セグメント変更
14. 非アクティブ日数
15. カスタムイベント

#### 2.9.2 アクションタイプ
- メッセージ送信（LINE/メール）
- タグ操作
- スコア更新
- キャンペーン開始
- セグメント移動
- オペレーター通知
- Webhook送信
- AI生成メッセージ

---

## 3. 非機能要件

### 3.1 パフォーマンス
- ページロード: 3秒以内
- API応答: 500ms以内
- 同時接続: 10,000ユーザー

### 3.2 可用性
- 稼働率: 99.9%
- バックアップ: 日次自動
- 災害復旧: 24時間以内

### 3.3 セキュリティ
- HTTPS必須
- データ暗号化（AES-256）
- GDPR/個人情報保護法準拠
- SOC2 Type II対応

### 3.4 スケーラビリティ
- マルチテナント対応
- 水平スケーリング対応
- CDN配信

---

## 4. システムアーキテクチャ

### 4.1 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | Next.js 16, React 19, TypeScript 5 |
| UIライブラリ | Tailwind CSS 4, Radix UI, Shadcn/ui |
| バックエンド | Next.js API Routes, Server Actions |
| データベース | PostgreSQL, Prisma ORM 7.3 |
| 認証 | Clerk |
| 決済 | Stripe |
| メール | SendGrid, Resend |
| LINE | LINE Bot SDK |
| AI | Anthropic Claude API |
| ストリーミング | LiveKit |
| リアルタイム | Pusher |
| ストレージ | Cloudflare R2 |
| キャッシュ | Redis (Upstash) |

### 4.2 データベース構造

```
主要テーブル（40+モデル）

┌─────────────────────────────────────────────────────────┐
│ マルチテナント層                                          │
│ - Tenant（テナント）                                      │
│ - User（ユーザー）                                        │
└─────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────┐
│ コンタクト管理層                                          │
│ - Contact（コンタクト）                                   │
│ - Tag（タグ）                                            │
│ - ContactTag（コンタクト-タグ紐付け）                     │
│ - ContactScore（スコア）                                 │
│ - BehaviorEvent（行動イベント）                          │
│ - MessageHistory（メッセージ履歴）                       │
└─────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────┐
│ キャンペーン層                                            │
│ - Campaign（キャンペーン）                                │
│ - CampaignStep（ステップ）                               │
│ - CampaignContact（進捗管理）                            │
│ - AutomationRule（オートメーションルール）                │
│ - AutomationTrigger/Action（トリガー/アクション）         │
└─────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────┐
│ コマース層                                               │
│ - Product（商品）                                        │
│ - Order（注文）                                          │
│ - Subscription（サブスクリプション）                      │
│ - Course（コース）                                       │
│ - Lesson（レッスン）                                     │
│ - CourseEnrollment（受講登録）                           │
└─────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────┐
│ アフィリエイト層                                          │
│ - Partner（パートナー）                                   │
│ - AffiliateLink（リンク）                                │
│ - AffiliateClick（クリック）                             │
│ - AffiliateConversion（コンバージョン）                  │
│ - AffiliateCommission（報酬）                            │
│ - AffiliatePayout（支払い）                              │
└─────────────────────────────────────────────────────────┘
```

---

## 5. API仕様

### 5.1 アフィリエイトAPI

#### パートナー管理
```
GET  /api/affiliate/partners?tenantId=xxx
POST /api/affiliate/partners
PATCH /api/affiliate/partners
```

#### トラッキング
```
GET  /api/affiliate/track?action=getClickId
POST /api/affiliate/track
PUT  /api/affiliate/track
```

#### コンバージョン
```
GET  /api/affiliate/conversions?tenantId=xxx
POST /api/affiliate/conversions
PATCH /api/affiliate/conversions
```

#### コミッション
```
GET  /api/affiliate/commissions?tenantId=xxx
POST /api/affiliate/commissions
```

#### 支払い
```
GET  /api/affiliate/payouts?tenantId=xxx
POST /api/affiliate/payouts
PATCH /api/affiliate/payouts
PUT  /api/affiliate/payouts (一括処理)
```

### 5.2 Webhook API

#### LINE Webhook
```
POST /api/webhooks/line?tenant=xxx
```

#### Stripe Webhook
```
POST /api/webhooks/stripe
```

### 5.3 分析API

#### スコアリング
```
GET /api/scores?contactId=xxx
```

#### 送信時刻最適化
```
GET /api/send-times?contactId=xxx
```

#### セグメント
```
GET /api/segments?contactId=xxx
```

---

## 6. 画面一覧

| パス | 画面名 | 説明 |
|------|--------|------|
| /dashboard | ダッシュボード | KPI概要、アクティビティ |
| /contacts | コンタクト一覧 | CRM管理 |
| /contacts/[id] | コンタクト詳細 | 個別コンタクト情報 |
| /campaigns | キャンペーン | ステップ/一斉配信管理 |
| /funnels | ファネル | LP/セールスファネル |
| /products | 商品 | 商品カタログ |
| /orders | 注文 | 注文管理 |
| /courses | コース | 会員コンテンツ |
| /webinar | イベント | ウェビナー/セミナー |
| /chat | チャット | ライブチャット |
| /tags | タグ | タグ管理 |
| /segments | セグメント | オーディエンス分類 |
| /ai/autopilot | オートパイロット | AI自動化設定 |
| /ai/content | コンテンツ生成 | AI文章生成 |
| /ai/predictions | 予測分析 | AI予測ダッシュボード |
| /automation/journeys | ジャーニー | カスタマージャーニー |
| /automation/ab-tests | A/Bテスト | テスト管理 |
| /automation/intent | 購買意図 | 意図分析 |
| /automation/sentiment | 感情分析 | センチメント分析 |
| /analytics/scores | スコア分析 | RFM/スコアリング |
| /analytics/send-times | 送信時刻 | 最適送信時刻 |
| /settings/* | 設定 | 各種設定 |

---

## 7. 料金プラン

| プラン | 月額 | コンタクト数 | 機能 |
|--------|------|-------------|------|
| STARTER | ¥9,800 | 1,000 | 基本機能 |
| STANDARD | ¥29,800 | 5,000 | + AI機能 |
| PRO | ¥79,800 | 20,000 | + オートパイロット |
| ENTERPRISE | 応相談 | 無制限 | フルカスタム |

---

## 8. 今後の拡張計画

### Phase 1（完了）
- [x] コア機能実装
- [x] LINE連携
- [x] メール配信
- [x] 決済連携
- [x] アフィリエイトシステム

### Phase 2（計画中）
- [ ] SMS配信
- [ ] WhatsApp連携
- [ ] Zapier連携
- [ ] APIドキュメント公開

### Phase 3（将来）
- [ ] モバイルアプリ
- [ ] ホワイトラベル
- [ ] マーケットプレイス

---

## 9. 更新履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| 1.0.0 | 2025-01-15 | 初版作成 |
| 1.5.0 | 2025-06-01 | AI機能追加 |
| 2.0.0 | 2026-02-01 | アフィリエイトシステム統合 |

# ADR-003: 送信時間最適化実装

## Status
Accepted

## Context
研究結果（ev-002）によると、AIが購読者行動から学習し最適送信時間を予測することで、開封率・クリック率の向上が期待できる。個人別の開封パターンを分析し、最適な送信タイミングを自動決定する機能を実装する。

## Decision

### 1. 分析アプローチ

**データ収集:**
- メール送信時刻と開封時刻を記録
- 直近100件の開封データを分析対象

**分析内容:**
- 時間帯別開封率（0-23時）
- 曜日別開封率（日-土）
- パターンの信頼度（データ量に基づく）

### 2. 最適時間決定ロジック

```
信頼度 >= 0.3: 個人の開封パターンを使用
信頼度 < 0.3: デフォルト設定を使用
```

**デフォルト設定:**
- ビジネス向け: 9, 10, 14, 15時
- コンシューマー向け: 8, 12, 20, 21時

### 3. 信頼度計算

```
信頼度 = min(1, データ数 / 30)
```
- 30件で100%信頼度
- 3件未満は分析対象外

### 4. データモデル

SendTimePreference:
- optimalHour: 最適時間（0-23）
- optimalDay: 最適曜日（0-6、null可）
- confidence: 信頼度（0-1）
- dataPoints: 分析に使用したデータ数
- hourlyPattern: 時間帯別開封率（JSON）

## Evidence
- [ev-002] "AIが購読者行動から学習し最適送信時間を予測。動的コンテンツ生成と次のメッセージ決定をAIが行う" - Knak

## Consequences

### Positive
- 個人別の最適タイミングで配信可能
- 開封率・クリック率の向上期待
- データ蓄積で精度向上

### Negative
- 初期はデータ不足で精度低い
- バッチ分析の処理負荷

### Risks
- データ不足時の予測精度
  → 対策: デフォルト設定でフォールバック

## Alternatives Considered

1. **固定時間配信**: シンプルだが個人最適化不可 → 却下
2. **ML予測モデル**: 高精度だが複雑 → 将来検討
3. **A/Bテスト方式**: 効果検証可能だがリソース必要 → 部分採用検討

## Implementation

- `src/lib/marketing/send-optimizer.ts`: 送信時間最適化エンジン
- `src/app/api/send-times/route.ts`: 送信時間API
- `src/app/(dashboard)/analytics/send-times/page.tsx`: 分析ダッシュボード

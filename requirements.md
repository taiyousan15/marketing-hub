# UTAGE × L-STEP 統合マーケティング自動化システム 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**統合マーケティング自動化プラットフォーム**（仮称：MarketingHub）

### 1.2 目的
UTAGE（オールインワンマーケティングシステム）とL-STEP（LINE特化MA）の機能を統合し、それらを超える次世代マーケティング自動化システムを開発する。

### 1.3 背景
- 現状、マーケターは複数のツールを併用する必要がある（LINE配信、メール配信、LP作成、決済、会員サイト等）
- ツール間のデータ連携が困難で、顧客体験が分断される
- AI・MCPの活用により、従来のツールにない付加価値を提供できる機会がある

### 1.4 スコープ
本プロジェクトでは以下を開発対象とする：
- Webアプリケーション（管理画面）
- LINE配信機能
- メール配信機能
- ファネル・LP作成機能
- 会員サイト機能
- 決済連携機能
- 予約・イベント管理機能
- 分析・レポート機能
- AI統合機能

### 1.5 関連ドキュメント

| ドキュメント | ファイル名 | 内容 |
|-------------|-----------|------|
| 要件定義書 | requirements.md | 本ドキュメント（何を作るか） |
| 設計書 | design.md | システムアーキテクチャ、DB設計、API設計 |
| 画面遷移・情報設計書 | screen-flow.md | サイトマップ、画面一覧、ユーザーフロー |
| タスク一覧 | tasks.md | 実装タスクと優先度 |

---

## 2. 思想・ビジョン

### 2.1 コアコンセプト
```
「1つのプラットフォームで、集客から販売、顧客育成まで完結」
```

### 2.2 設計思想

#### 2.2.1 オールインワン
- 複数ツールの契約・管理が不要
- 顧客データの一元管理
- マーケティング施策の一貫性

#### 2.2.2 AI-First
- AIによるコピーライティング支援
- 予測分析による最適化提案
- チャットボットによる自動応答

#### 2.2.3 MCP統合
- Model Context Protocol による拡張性
- 外部ツールとの柔軟な連携
- 将来の機能拡張に対応

#### 2.2.4 ノーコード
- プログラミング不要でファネル構築
- ドラッグ&ドロップによる直感的操作
- テンプレートによる素早い立ち上げ

### 2.3 差別化ポイント
| 要素 | 競合（UTAGE/L-STEP） | 本システム |
|------|---------------------|-----------|
| AI統合 | なし | Claude/GPTによるコピー生成、予測分析 |
| MCP連携 | なし | 外部ツールとの柔軟な連携基盤 |
| リアルタイム分析 | 基本的な分析 | ライブダッシュボード、ファネル可視化 |
| マルチチャネル | LINE or メール | LINE + メール + SMS + Push統合 |

---

## 3. ターゲットユーザー

### 3.1 プライマリペルソナ

#### ペルソナ1: コーチ・コンサルタント
| 項目 | 詳細 |
|------|------|
| 年齢層 | 30〜50代 |
| 売上規模 | 年商数十万円〜数千万円 |
| 従業員数 | 1〜3名（個人事業主中心） |
| 課題 | セールスが苦手、スケールしない、ナーチャリングの自動化 |
| 求める機能 | 個別相談予約、ステップ配信、Zoom連携、決済・会員サイト |
| 予算感 | 月額1〜5万円 |

#### ペルソナ2: オンラインスクール運営者
| 項目 | 詳細 |
|------|------|
| 年齢層 | 30〜50代 |
| 売上規模 | 年商500万円〜5,000万円 |
| 従業員数 | 1〜10名 |
| 課題 | 複数ツール管理の煩雑さ、会員サイト構築コスト、継続率向上 |
| 求める機能 | 会員サイト、サブスク課金、段階的コンテンツ公開、進捗管理 |
| 予算感 | 月額2〜5万円 |

#### ペルソナ3: 店舗ビジネス（美容室・エステ・整体・飲食店）
| 項目 | 詳細 |
|------|------|
| 年齢層 | 30〜50代 |
| 売上規模 | 年商1,000万円〜1億円 |
| 従業員数 | 3〜20名 |
| 課題 | 予約サイト手数料、ドタキャン、リピーター獲得 |
| 求める機能 | LINE予約、リマインダ、ポイントカード、口コミ促進 |
| 予算感 | 月額1〜3万円 |

### 3.2 セカンダリペルソナ

#### ペルソナ4: EC・物販事業者
| 項目 | 詳細 |
|------|------|
| 課題 | リピート率が低い（2〜5%）、購入後フォローが属人的 |
| 求める機能 | 購入後自動フォロー、セグメント別クーポン、リピート促進シナリオ |
| 予算感 | 月額3〜10万円 |

#### ペルソナ5: 情報発信者・インフルエンサー
| 項目 | 詳細 |
|------|------|
| 課題 | フォロワーのマネタイズに苦労、広告収入以外の収益源がない |
| 求める機能 | SNS→LINE導線、ファンコミュニティ、デジタルコンテンツ販売 |
| 予算感 | 月額1〜3万円 |

#### ペルソナ6: BtoB企業
| 項目 | 詳細 |
|------|------|
| 課題 | リードナーチャリングが属人的、メルマガ開封率が低い |
| 求める機能 | リード管理、スコアリング、セグメント配信、商談予約自動化 |
| 予算感 | 月額5〜30万円 |

---

## 4. 機能要件

### 4.1 配信機能

#### 4.1.1 LINE配信
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| LINE-001 | シナリオ配信 | 登録日を起点としたステップ配信。最大99,999日後まで設定可能。条件分岐対応 | 必須 |
| LINE-002 | 一斉配信 | 全友だちまたはセグメントへの一括配信 | 必須 |
| LINE-003 | セグメント配信 | タグ・属性・行動履歴による絞り込み配信 | 必須 |
| LINE-004 | リマインダ配信 | 予約日・イベント日を起点とした逆算配信 | 必須 |
| LINE-005 | 自動応答 | キーワードに応じた自動返信（完全一致・部分一致） | 必須 |
| LINE-006 | Flex Message | カスタムレイアウトのリッチメッセージ作成 | 必須 |
| LINE-007 | カルーセル | 横スクロール可能な複数パネル（最大10枚） | 必須 |
| LINE-008 | リッチメニュー | セグメント別リッチメニュー表示（最大20ボタン） | 必須 |
| LINE-009 | テンプレート | 定型メッセージの保存・再利用（最大1,000件） | 必須 |
| LINE-010 | 個別トーク | 1対1のリアルタイムチャット | 必須 |

#### 4.1.2 メール配信
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| MAIL-001 | ステップメール | 登録日を起点とした自動配信 | 必須 |
| MAIL-002 | 一斉配信 | メルマガ形式の一括配信 | 必須 |
| MAIL-003 | セグメント配信 | 条件による絞り込み配信 | 必須 |
| MAIL-004 | HTMLメール | リッチなデザインメール対応 | 必須 |
| MAIL-005 | A/Bテスト | 件名・本文のA/Bテスト | 推奨 |
| MAIL-006 | DKIM/DMARC | メール認証対応 | 必須 |

#### 4.1.3 SMS配信
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| SMS-001 | SMS配信 | 日本国内の携帯番号への配信 | 推奨 |
| SMS-002 | リマインダSMS | 予約・イベントのリマインダ | 推奨 |

### 4.2 顧客管理機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| CRM-001 | コンタクト管理 | 顧客情報の一元管理（メール、LINE、電話） | 必須 |
| CRM-002 | タグ管理 | 最大10,000種類のタグによる分類 | 必須 |
| CRM-003 | カスタムフィールド | 最大100項目のカスタム属性 | 必須 |
| CRM-004 | 行動スコアリング | アクションに応じたポイント付与 | 必須 |
| CRM-005 | 流入経路分析 | 登録元の追跡（広告、SNS、QR等） | 必須 |
| CRM-006 | 統合プロフィール | LINE/メール/購買履歴の統合表示 | 必須 |

### 4.3 ファネル・LP作成機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| FNL-001 | ドラッグ&ドロップビルダー | 直感的なページ作成 | 必須 |
| FNL-002 | テンプレート | 14種類以上のプロ監修テンプレート | 必須 |
| FNL-003 | ページ要素 | 30種類以上の要素（テキスト、画像、動画、フォーム等） | 必須 |
| FNL-004 | A/Bテスト | ページのA/Bテスト機能 | 必須 |
| FNL-005 | ポップアップ | イグジットポップアップ、クリックポップアップ | 必須 |
| FNL-006 | カウントダウン | 期限カウントダウン表示 | 必須 |
| FNL-007 | 登録フォーム | メール/LINE登録フォーム | 必須 |
| FNL-008 | 決済フォーム | 埋め込み決済フォーム | 必須 |
| FNL-009 | UTMトラッキング | 流入元パラメータの自動取得 | 必須 |
| FNL-010 | 独自ドメイン | カスタムドメイン設定 | 必須 |

### 4.4 会員サイト機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| MEM-001 | コース管理 | 複数コースの作成・管理 | 必須 |
| MEM-002 | レッスン管理 | コース内のレッスン構成 | 必須 |
| MEM-003 | 動画配信 | UTAGE/YouTube/Vimeo対応 | 必須 |
| MEM-004 | チャプター機能 | 動画内チャプターリスト | 推奨 |
| MEM-005 | 入会日制限 | 登録日に応じた段階的公開 | 必須 |
| MEM-006 | 進捗管理 | 受講完了状態の管理 | 必須 |
| MEM-007 | コメント機能 | レッスンへのコメント投稿 | 推奨 |
| MEM-008 | バンドルコース | 複数コースのパッケージ化 | 推奨 |
| MEM-009 | 自動アクセス権付与 | 決済完了時の自動登録 | 必須 |

### 4.5 決済機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| PAY-001 | Stripe連携 | クレジットカード決済 | 必須 |
| PAY-002 | 単発決済 | 一回払い | 必須 |
| PAY-003 | サブスクリプション | 月額・年額の継続課金 | 必須 |
| PAY-004 | 分割払い | 複数回払い | 推奨 |
| PAY-005 | 3Dセキュア | 3Dセキュア2.0対応 | 必須 |
| PAY-006 | 返金処理 | 全額・一部返金 | 必須 |
| PAY-007 | 領収書発行 | 自動領収書発行 | 必須 |
| PAY-008 | オーダーバンプ | 追加商品のワンクリック購入 | 推奨 |
| PAY-009 | アップセル | 購入後の追加オファー | 推奨 |
| PAY-010 | UnivaPay連携 | 日本向け決済 | 推奨 |
| PAY-011 | AQUAGATES連携 | 日本向け決済（審査緩め） | 任意 |

### 4.6 予約・イベント機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| RSV-001 | カレンダー予約 | 空き時間からの予約受付 | 必須 |
| RSV-002 | イベント予約 | 特定日時のイベント枠管理 | 必須 |
| RSV-003 | Googleカレンダー連携 | 空き時間の自動反映 | 必須 |
| RSV-004 | Zoom連携 | ミーティングURL自動発行 | 必須 |
| RSV-005 | Google Meet連携 | ミーティングURL自動発行 | 推奨 |
| RSV-006 | リマインダ連携 | 予約日前の自動通知 | 必須 |
| RSV-007 | キャンセル管理 | キャンセル・変更対応 | 必須 |

### 4.7 自動ウェビナー機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| WEB-001 | 擬似ライブ配信 | 録画動画のライブ風配信 | 推奨 |
| WEB-002 | 日程選択 | 複数日程からの選択 | 推奨 |
| WEB-003 | チャット機能 | 事前設定コメントの表示 | 推奨 |
| WEB-004 | カウントダウン | 開始前カウントダウン | 推奨 |

### 4.8 アフィリエイト機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| AFF-001 | パートナー登録 | アフィリエイター登録管理 | 推奨 |
| AFF-002 | 紹介リンク発行 | トラッキングURL生成 | 推奨 |
| AFF-003 | 成果計測 | 登録・購入の成果追跡 | 推奨 |
| AFF-004 | 報酬計算 | 報酬の自動計算 | 推奨 |
| AFF-005 | 報酬承認 | 成果の承認・非承認 | 推奨 |
| AFF-006 | ランキング | パートナーランキング表示 | 任意 |

### 4.9 分析・レポート機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| ANL-001 | ファネル分析 | 段階別離脱率・移行率 | 必須 |
| ANL-002 | クロス分析 | 複数条件の掛け合わせ分析 | 必須 |
| ANL-003 | 流入経路分析 | 登録元別の分析 | 必須 |
| ANL-004 | URLクリック測定 | リンククリック率計測 | 必須 |
| ANL-005 | 開封率・クリック率 | メール/LINE配信効果測定 | 必須 |
| ANL-006 | 売上レポート | 日別・月別売上集計 | 必須 |
| ANL-007 | リアルタイムダッシュボード | ライブ指標表示 | 推奨 |
| ANL-008 | CSV出力 | データエクスポート | 必須 |

### 4.10 AI統合機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| AI-001 | AIコピーライティング | メール/LINE文面の自動生成 | 推奨 |
| AI-002 | AIチャットボット | 自動応答の高度化 | 推奨 |
| AI-003 | 予測分析 | 購買予測、離脱予測 | 任意 |
| AI-004 | レコメンデーション | 最適配信タイミング提案 | 任意 |

### 4.11 管理機能

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| ADM-001 | マルチテナント | アカウント別のデータ分離 | 必須 |
| ADM-002 | ユーザー認証 | ログイン・セッション管理 | 必須 |
| ADM-003 | 権限管理 | 管理者/運用者/一般の権限設定 | 必須 |
| ADM-004 | オペレーター機能 | スタッフアカウント発行 | 必須 |
| ADM-005 | 監査ログ | 操作履歴の記録 | 必須 |
| ADM-006 | バックアップ | データバックアップ | 必須 |

---

## 5. 非機能要件

### 5.1 パフォーマンス要件

| 項目 | 要件 |
|------|------|
| ページ読み込み時間 | 95%のリクエストが2秒以内 |
| API応答時間 | 95%のリクエストが500ms以内 |
| LINE配信スループット | 10万通/時間 |
| メール配信スループット | 5万通/時間 |
| 同時接続数 | 10,000接続 |

### 5.2 可用性要件

| 項目 | 要件 |
|------|------|
| サービス稼働率 | 99.9%（年間ダウンタイム8.76時間以内） |
| 計画メンテナンス | 月1回、深夜帯に2時間以内 |
| 障害復旧時間（RTO） | 4時間以内 |
| データ復旧ポイント（RPO） | 1時間以内 |

### 5.3 スケーラビリティ要件

| 項目 | 要件 |
|------|------|
| 最大テナント数 | 10,000テナント |
| テナントあたり最大コンタクト数 | 100万件 |
| 最大同時配信数 | 100万通 |
| ストレージ容量 | テナントあたり1TB |

### 5.4 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 通信暗号化 | TLS 1.3 |
| データ暗号化 | AES-256（保存時） |
| 認証 | OAuth 2.0 / JWT |
| パスワードポリシー | 8文字以上、英数字記号混合 |
| 二要素認証 | 対応必須 |
| セッションタイムアウト | 24時間（設定可能） |
| IPアドレス制限 | オプション対応 |
| 脆弱性診断 | 年1回以上 |

---

## 6. 技術要件

### 6.1 技術スタック

| レイヤー | 技術 |
|----------|------|
| フロントエンド | Next.js 15（App Router）, React 19, TypeScript |
| UI | Tailwind CSS v4, shadcn/ui |
| フォーム | React Hook Form, Zod |
| ドラッグ&ドロップ | dnd-kit |
| リッチテキスト | Tiptap |
| バックエンド | Next.js Server Actions / API Routes |
| ORM | Prisma |
| データベース | PostgreSQL（Cloud SQL） |
| キャッシュ | Redis（Upstash） |
| ジョブキュー | Cloud Tasks, Cloud Scheduler |
| リアルタイム通信 | Pusher |
| 認証 | Clerk |
| ホスティング | Google Cloud Run |
| CDN | Cloudflare |
| ストレージ | Cloudflare R2 |
| 動画配信 | Cloudflare Stream |
| CI/CD | GitHub Actions |

### 6.2 外部API連携

| API | 用途 | 必須/推奨 |
|-----|------|----------|
| LINE Messaging API | LINE配信 | 必須 |
| Stripe API | 決済処理 | 必須 |
| SendGrid API | メール配信 | 必須 |
| Zoom API | ビデオ会議 | 必須 |
| Google Calendar API | 予約管理 | 必須 |
| Google Sheets API | データ連携 | 推奨 |
| Twilio API | SMS配信 | 推奨 |
| Claude API | AI機能 | 推奨 |

### 6.3 インフラ構成

```
┌─────────────────────────────────────────────────────────────────┐
│                      Cloudflare CDN                             │
└───────────────────────────┬─────────────────────────────────────┘
                            │
┌───────────────────────────┴─────────────────────────────────────┐
│                    Google Cloud Run                             │
│                    (Next.js 15 Application)                     │
└───────┬───────────────────┬───────────────────┬─────────────────┘
        │                   │                   │
   ┌────┴────┐         ┌────┴────┐         ┌────┴────┐
   │ Cloud   │         │ Upstash │         │ Pusher  │
   │ SQL     │         │ Redis   │         │         │
   └─────────┘         └─────────┘         └─────────┘
        │
   ┌────┴────┐
   │ Cloud   │
   │ Tasks   │
   └─────────┘
```

---

## 7. 法的・コンプライアンス要件

### 7.1 特定商取引法対応

| 要件ID | 要件 | 実装方法 |
|--------|------|----------|
| LAW-001 | 事業者情報表示 | 決済ページに自動表示 |
| LAW-002 | 返品特約表示 | 最終確認画面に明記 |
| LAW-003 | 定期購入条件表示 | 各回の代金・総額を明示 |

### 7.2 特定電子メール法対応

| 要件ID | 要件 | 実装方法 |
|--------|------|----------|
| LAW-004 | オプトイン取得 | チェックボックス + 同意記録保存 |
| LAW-005 | 配信停止機能 | ワンクリック解除、List-Unsubscribeヘッダー |
| LAW-006 | 送信者情報表示 | メール本文に自動挿入 |

### 7.3 個人情報保護法対応

| 要件ID | 要件 | 実装方法 |
|--------|------|----------|
| LAW-007 | プライバシーポリシー | 登録時に同意取得 |
| LAW-008 | 利用目的明示 | 登録フォームに明記 |
| LAW-009 | 開示請求対応 | 管理画面からデータ出力 |
| LAW-010 | 削除請求対応 | データ削除機能 |
| LAW-011 | 同意記録保存 | 日時・IP・画面構成を記録 |

### 7.4 LINE利用規約対応

| 要件ID | 要件 | 実装方法 |
|--------|------|----------|
| LAW-012 | 禁止コンテンツ排除 | コンテンツ審査ガイドライン |
| LAW-013 | 配信頻度管理 | 週1回〜月4回を推奨表示 |
| LAW-014 | ブロック率モニタリング | ダッシュボードに表示 |

### 7.5 決済関連法規対応

| 要件ID | 要件 | 実装方法 |
|--------|------|----------|
| LAW-015 | 3Dセキュア対応 | Stripe 3DS2自動対応 |
| LAW-016 | カード情報非保持 | トークン化 |

### 7.6 景品表示法対応

| 要件ID | 要件 | 実装方法 |
|--------|------|----------|
| LAW-017 | ステマ規制対応 | 広告表記ガイドライン提供 |

---

## 8. 合格ライン（受け入れ基準）

### 8.1 機能パリティ

| 基準 | 目標値 |
|------|--------|
| UTAGE同等機能の実現率 | 89%以上 |
| L-STEP同等機能の実現率 | 92%以上 |
| 差別化機能（AI/MCP）の実装 | 80%以上 |

### 8.2 パフォーマンス基準

| 基準 | 目標値 |
|------|--------|
| ページ読み込み（95パーセンタイル） | 2秒以内 |
| API応答時間（95パーセンタイル） | 500ms以内 |
| LINE配信完了時間（10万通） | 1時間以内 |
| メール配信完了時間（5万通） | 1時間以内 |

### 8.3 品質基準

| 基準 | 目標値 |
|------|--------|
| テストカバレッジ | 80%以上 |
| クリティカルバグ | 0件 |
| 重大バグ | リリース時5件以内 |
| 軽微バグ | リリース時20件以内 |

### 8.4 セキュリティ基準

| 基準 | 目標値 |
|------|--------|
| OWASP Top 10対応 | 全項目対応 |
| 脆弱性診断 | 重大・高リスク0件 |
| ペネトレーションテスト | 合格 |

### 8.5 ユーザビリティ基準

| 基準 | 目標値 |
|------|--------|
| 初期設定完了時間 | 30分以内 |
| ファネル作成時間（テンプレート使用） | 10分以内 |
| ステップ配信設定時間 | 15分以内 |

---

## 9. 制約事項

### 9.1 技術的制約

| 制約 | 詳細 |
|------|------|
| LINE API制限 | メッセージ通数はプラン依存、Flex Message 30KB制限 |
| Zoom API制限 | 100ミーティング/日/ユーザー、ISVライセンス必要 |
| 決済審査 | Stripe事後審査によるアカウント凍結リスク |

### 9.2 ビジネス的制約

| 制約 | 詳細 |
|------|------|
| 開発予算 | （要確認） |
| 開発期間 | （要確認） |
| 開発チーム規模 | （要確認） |

### 9.3 法的制約

| 制約 | 詳細 |
|------|------|
| 禁止業種 | 決済代行会社の禁止業種に該当するユーザーは利用不可 |
| 地域制限 | 日本国内向けサービス |

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| ファネル | 見込み客を顧客に変換するためのページ群（LP→サンクス等） |
| ステップ配信 | 登録日を起点とした自動配信シナリオ |
| セグメント | 特定条件で絞り込んだ顧客グループ |
| リッチメニュー | LINEトーク画面下部に表示される固定メニュー |
| Flex Message | LINEの自由レイアウトメッセージ形式 |
| オプトイン | メール配信の事前同意取得 |
| 3Dセキュア | クレジットカード決済の本人認証 |
| MCP | Model Context Protocol（AIとツールの連携プロトコル） |
| テナント | 本システムを利用する各顧客（アカウント） |

---

## 11. 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| 1.0 | 2025-01-31 | 初版作成 | - |

---

## 12. 承認

| 役割 | 氏名 | 日付 | 署名 |
|------|------|------|------|
| プロダクトオーナー | | | |
| 技術責任者 | | | |
| プロジェクトマネージャー | | | |
